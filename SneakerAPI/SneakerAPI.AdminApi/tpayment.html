<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <button onclick="createPaymentUrl(50000000, 'Thanh to√°n ƒë∆°n h√†ng #123')">Thanh to√°n VNPay 500000</button>
    <!-- <button onclick="checkPaymentStatus(123)">Ki·ªÉm tra thanh to√°n</button> -->



<script>
async function checkout(accountId, orderPayment, cartItems) {
    const url = "https://localhost:4000/Customer/Order/checkout"; 

    const data = {
        accountId: accountId,  // üîÑ Ch·ªânh s·ª≠a key ƒë·ªÉ kh·ªõp v·ªõi DTO
        orderPayment: orderPayment,  // üîÑ Chuy·ªÉn ƒë·ªïi th√†nh string
        cartItemIds: cartItems
    };

    console.log("Sending data:", data);

    try {
        const response = await fetch(url, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(data)
        });

        const result = await response.json();
        if (response.ok) {
            console.log("Checkout th√†nh c√¥ng:", result);
        } else {
            console.error("L·ªói khi checkout:", result);
        }
    } catch (error) {
        console.error("L·ªói k·∫øt n·ªëi API:", error);
    }
}



    // H√†m t·∫°o URL thanh to√°n v√† chuy·ªÉn h∆∞·ªõng ng∆∞·ªùi d√πng ƒë·∫øn VNPay
async function createPaymentUrl(moneyToPay, description) {
    try {
        const ticks = Date.now() * 10101;
        console.log(typeof(ticks))
        const response = await fetch(`https://localhost:4000/Customer/Vnpay/CreatePaymentUrl?moneyToPay=${moneyToPay}&orderPayment=17601489303381944&description=${encodeURIComponent(description)}`, {
            method: "GET"
        });

        if (!response.ok) {
            throw new Error("Failed to create payment URL");
        }

        const paymentUrl = await response.text(); // L·∫•y URL thanh to√°n
        // await checkout(15, ticks,[6]);
        window.open(paymentUrl, '_blank'); // Chuy·ªÉn h∆∞·ªõng ng∆∞·ªùi d√πng ƒë·∫øn VNPay
    } catch (error) {
        console.error("Error creating payment URL:", error);
        alert("C√≥ l·ªói x·∫£y ra khi t·∫°o URL thanh to√°n.");
    }
}

// H√†m ki·ªÉm tra tr·∫°ng th√°i thanh to√°n t·ª´ VNPay d·ª±a tr√™n orderId


// H√†m x·ª≠ l√Ω Callback khi VNPay chuy·ªÉn h∆∞·ªõng ng∆∞·ªùi d√πng v·ªÅ trang web
async function handlePaymentCallback() {
    try {
        const response = await fetch(`https://localhost:4000/Customer/Vnpay/Callback`, {
            method: "GET"
        });

        const result = await response.text();
        console.log("Payment Callback Result:", result);
        alert(result); // Hi·ªÉn th·ªã k·∫øt qu·∫£ giao d·ªãch cho ng∆∞·ªùi d√πng
    } catch (error) {
        console.error("Error handling payment callback:", error);
        alert("C√≥ l·ªói x·∫£y ra khi x·ª≠ l√Ω k·∫øt qu·∫£ thanh to√°n.");
    }
}



// T·ª± ƒë·ªông g·ªçi h√†m handlePaymentCallback() khi trang callback ƒë∆∞·ª£c load
document.addEventListener("DOMContentLoaded", function () {
    if (window.location.pathname.includes("https://localhost:4000/Customer/Vnpay/Callback")) { // Thay th·∫ø "payment-result" b·∫±ng URL callback th·ª±c t·∫ø c·ªßa b·∫°n
        handlePaymentCallback();
    }
});

</script>
</body>
</html>